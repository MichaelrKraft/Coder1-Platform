<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation CSS Injection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #preview {
            margin-top: 20px;
            border: 1px solid #ddd;
            min-height: 200px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>CSS Animation Injection Test</h1>
    
    <div class="test-container">
        <h2>Test 1: Direct CSS Injection</h2>
        <button onclick="testDirectInjection()">Test Direct Injection</button>
        <div id="direct-result"></div>
    </div>

    <div class="test-container">
        <h2>Test 2: innerHTML with Animation</h2>
        <button onclick="testInnerHTMLAnimation()">Test innerHTML Animation</button>
        <div id="innerHTML-result"></div>
    </div>

    <div class="test-container">
        <h2>Test 3: Component Browser Method</h2>
        <button onclick="testComponentBrowserMethod()">Test Component Browser Method</button>
        <div id="preview"></div>
    </div>

    <div class="test-container">
        <h2>Current Styles in Head</h2>
        <button onclick="listHeadStyles()">List All Style Tags</button>
        <pre id="styles-list"></pre>
    </div>

    <script>
        function testDirectInjection() {
            // Inject CSS directly
            const style = document.createElement('style');
            style.id = 'test-blink-style';
            style.textContent = `
                @keyframes test-blink {
                    0%, 50% { opacity: 1; }
                    51%, 100% { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Add element with animation
            const result = document.getElementById('direct-result');
            result.innerHTML = `
                <div style="padding: 20px; background: #f0f0f0; border-radius: 4px;">
                    <span style="font-size: 20px;">Blinking cursor: </span>
                    <span style="animation: test-blink 1s infinite; font-size: 20px; font-weight: bold;">|</span>
                </div>
            `;
            
            console.log('Direct injection test completed');
        }

        function testInnerHTMLAnimation() {
            // First inject the CSS
            if (!document.getElementById('innerHTML-blink-style')) {
                const style = document.createElement('style');
                style.id = 'innerHTML-blink-style';
                style.textContent = `
                    @keyframes innerHTML-blink {
                        0%, 50% { opacity: 1; color: red; }
                        51%, 100% { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Then set innerHTML
            const result = document.getElementById('innerHTML-result');
            const html = `
                <div style="padding: 20px; background: #e0e0e0; border-radius: 4px;">
                    <span style="font-size: 20px;">Red blinking text: </span>
                    <span style="animation: innerHTML-blink 0.5s infinite; font-size: 20px; font-weight: bold; color: red;">ALERT!</span>
                </div>
            `;
            result.innerHTML = html;
            
            console.log('innerHTML animation test completed');
        }

        function testComponentBrowserMethod() {
            // This mimics exactly what component-browser.html does
            const animationId = 'typewriter-blink';
            
            if (!document.getElementById(animationId + '-style')) {
                console.log('Creating typewriter animation style...');
                const style = document.createElement('style');
                style.id = animationId + '-style';
                style.textContent = `
                    @keyframes ${animationId} {
                        0%, 50% { opacity: 1; }
                        51%, 100% { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
                console.log('Typewriter animation style added to head');
            }
            
            const previewContent = `
                <div style="display: flex; align-items: center; justify-content: center; padding: 40px; background: #f8fafc; border-radius: 8px;">
                    <div style="font-size: 24px; font-weight: 600; color: #3b82f6; font-family: monospace; position: relative;">
                        ✨ Typewriter Effect ✨<span style="animation: ${animationId} 1s infinite; margin-left: 4px; color: #3b82f6; font-weight: bold;">|</span>
                    </div>
                </div>
            `;
            
            const preview = document.getElementById('preview');
            preview.innerHTML = previewContent;
            
            // Check if animation is working
            const animatedElements = preview.querySelectorAll('[style*="animation"]');
            console.log('Animated elements found:', animatedElements.length);
            animatedElements.forEach(el => {
                const computedStyle = window.getComputedStyle(el);
                console.log('Element:', el.tagName);
                console.log('Animation property:', computedStyle.animation);
                console.log('Animation name:', computedStyle.animationName);
                console.log('Animation duration:', computedStyle.animationDuration);
            });
        }

        function listHeadStyles() {
            const styles = document.querySelectorAll('style');
            const list = document.getElementById('styles-list');
            let output = `Total style tags: ${styles.length}\n\n`;
            
            styles.forEach((style, index) => {
                output += `Style ${index + 1}:\n`;
                output += `ID: ${style.id || '(no id)'}\n`;
                output += `Content preview: ${style.textContent.substring(0, 100)}...\n\n`;
            });
            
            list.textContent = output;
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            console.log('Page loaded, ready for testing');
            
            // Check if animations are supported
            const testEl = document.createElement('div');
            testEl.style.animation = 'test 1s';
            const animationSupported = testEl.style.animation !== '';
            console.log('CSS animations supported:', animationSupported);
        });
    </script>
</body>
</html>